#cloud-config
# =============================================================================
# Generated by CHOOSE-YOU! ğŸ¯
# Hostname: my-server
# Generated: Fri Nov 14 11:42:25 EST 2025
# =============================================================================

# Set hostname
hostname: my-server
fqdn: my-server.local

# System packages
packages:
  - curl
  - git
  - vim
  - htop
  - ncdu
  - tmux

# Run commands on first boot
runcmd:
  # Install Tailscale
  - curl -fsSL https://tailscale.com/install.sh | sh

  # Authenticate with Tailnet
  - |
    tailscale up \
      --authkey=op read "op://ytge5yzehzilhlmdfdgtso2pbe/TS_descartes-stack/credential" \
      --hostname=my-server \
      --advertise-tags=tag:vm,tag:cloud-init \
      --ssh

  # Install portable dotfiles
  - curl -fsSL https://raw.githubusercontent.com/UncertainMeow/dotfiles/main/bootstrap-portable.sh | bash

  # Set timezone
  - timedatectl set-timezone America/New_York

  # Display info
  - echo "âœ… VM provisioned successfully!" > /etc/motd
  - echo "Hostname: my-server" >> /etc/motd
  - echo "Tailscale: Connected" >> /etc/motd

# Create user
users:
  - name: kellen
    groups: [sudo, docker]
    sudo: ALL=(ALL) NOPASSWD:ALL
    shell: /bin/zsh
    ssh_authorized_keys:
      - ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEHueouBy3PUTO8PbkBkqYmmZ703NT3e/xOrJDqSaG5f

# Security - disable root password login
ssh_pwauth: false
disable_root: true

# Final setup message
final_message: |
  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
  â•‘        âš¡ Cloud-Init Complete!                          â•‘
  â•‘        VM: my-server                                      â•‘
  â•‘        Status: Connected to Tailnet                     â•‘
  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  Access via Tailscale:
    ssh kellen@my-server

# Reboot after provisioning (optional)
power_state:
  mode: reboot
  delay: now
  message: "Provisioning complete - rebooting"
  condition: true
